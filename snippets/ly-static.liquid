{% assign language = cart.attributes["language"] %}{% if language == nil %}{% assign language = shop.metafields["languages"]["default"] %}{% endif %}{% assign content = ly-static %}{% assign strings = content | strip_newlines | split: '<ly-' %}{% for each_string in strings %}{% if each_string contains '</ly' %}{% assign ly_string = each_string | split: '</ly' | first %}{% assign ly_tag = ly_string | split: '>' | first %}{% assign ly_open_tag = '<ly-' | append: ly_tag | append: '>' %}{% assign ly_close_tag = '</ly-' | append: ly_tag | append: '>' %}{% assign ly_complete_tag = ly_open_tag | append: ly_close_tag %}{% assign delim = ly_tag | append: '>' %}{% assign ly_content = ly_string | split: delim | last %}{% assign tag_parts = ly_tag | split: '-' %}{% assign type = tag_parts | first %}{% assign id = tag_parts | last %}{% assign src = ly_open_tag | append: ly_content | append: ly_close_tag %}{% assign used_translation = nil %}{% assign namespace = language | append: 'as' %}{% assign key = 'tid' | append: theme.id %}{% if shop.metafields[namespace][key] %}{% assign data = shop.metafields[namespace][key] %}{% assign splitter = '[ly' | append: id | append: ']' %}{% if data contains splitter %}{% assign used_translation =  data | split: splitter | last | split: '[ly]' | first %}{% endif %}{% endif %}{% if used_translation %}{% assign content = content | replace: src, used_translation %}{% else %}{% assign namespace = language | append: type %}{% assign key = 'id' | append: id %}{% if shop.metafields[namespace][key] %}{% assign content = content | replace: src, shop.metafields[namespace][key] %}{% else %}{% assign content = content | replace: src, ly_content %}{% endif %}{% endif %}{% endif %}{% endfor %}{% assign strings = content | strip_newlines | split: '&lt;ly-' %}{% for each_string in strings %}{% if each_string contains '&lt;/ly' %}{% assign ly_string = each_string | split: '&lt;/ly' | first %}{% assign ly_tag = ly_string | split: '&gt;' | first %}{% assign ly_open_tag = '&lt;ly-' | append: ly_tag | append: '&gt;' %}{% assign ly_close_tag = '&lt;/ly-' | append: ly_tag | append: '&gt;' %}{% assign ly_complete_tag = ly_open_tag | append: ly_close_tag %}{% assign delim = ly_tag | append: '&gt;' %}{% assign ly_content = ly_string | split: delim | last %}{% assign tag_parts = ly_tag | split: '-' %}{% assign type = tag_parts | first %}{% assign id = tag_parts | last %}{% assign src = ly_open_tag | append: ly_content | append: ly_close_tag %}{% assign used_translation = nil %}{% assign namespace = language | append: 'as' %}{% assign key = 'tid' | append: theme.id %}{% if shop.metafields[namespace][key] %}{% assign data = shop.metafields[namespace][key] %}{% assign splitter = '[ly' | append: id | append: ']' %}{% if data contains splitter %}{% assign used_translation =  data | split: splitter | last | split: '[ly]' | first %}{% endif %}{% endif %}{% if used_translation %}{% assign content = content | replace: src, used_translation %}{% else %}{% assign namespace = language | append: type %}{% assign key = 'id' | append: id %}{% if shop.metafields[namespace][key] %}{% assign content = content | replace: src, shop.metafields[namespace][key] %}{% else %}{% assign content = content | replace: src, ly_content %}{% endif %}{% endif %}{% endif %}{% endfor %}{% for custom in shop.metafields.custom %}{% assign src = custom | last %}{% assign key = custom | first %}{% assign key = key | split: "ly" | last %}{% assign translation_namespace = language | append: "cu" %}{% assign translation_key = "id" | append: key %}{% if shop.metafields[translation_namespace][translation_key] %}{% assign translation = shop.metafields[translation_namespace][translation_key] %}{% assign src1 = '"' | append: src | append: '"' %}{% assign dst1 = '"' | append: translation | append: '"' %}{% assign src2 = "'" | append: src | append: "'" %}{% assign dst2 = "'" | append: translation | append: "'" %}{% assign src3 = ">" | append: src | append: "<" %}{% assign dst3 = ">" | append: translation | append: "<" %}{% assign content = content | replace: src1, dst1 %}{% assign content = content | replace: src2, dst2 %}{% assign content = content | replace: src3, dst3 %}{% endif%}{% endfor %}{% assign tag_translation_namespace = "ta" | append: language %}{% for tag_translation in shop.metafields[tag_translation_namespace] %}{% assign src = tag_translation | first %}{% assign translation = tag_translation | last %}{% assign src1 = '"' | append: src | append: '"' %}{% assign dst1 = '"' | append: translation | append: '"' %}{% assign src2 = "'" | append: src | append: "'" %}{% assign dst2 = "'" | append: translation | append: "'" %}{% assign src3 = ">" | append: src | append: "<" %}{% assign dst3 = ">" | append: translation | append: "<" %}{% assign content = content | replace: src1, dst1 %}{% assign content = content | replace: src2, dst2 %}{% assign content = content | replace: src3, dst3 %}{% endfor %}{% assign translation_mode_key = 'ly' | append: theme.id %}{% if shop.metafields.translation_mode[translation_mode_key] == 'non-strict' %}{% if template == 'product' %}{% for variant in product.variants %}{% if variant.metafields[language]['title'] %}{% assign src = variant.title %}{% assign translation = variant.metafields[language]['title'] %}{% assign src1 = '"' | append: src | append: '"' %}{% assign dst1 = '"' | append: translation | append: '"' %}{% assign content = content | replace: src1, dst1 %}{% endif %}{% endfor %}{% endif %}{% assign vendor_translation_namespace = 've' | append: language %}{% for vendor_translation in shop.metafields[vendor_translation_namespace] %}{% assign src = vendor_translation | first %}{% assign translation = vendor_translation | last %}{% assign src1 = '"' | append: src | append: '"' %}{% assign dst1 = '"' | append: translation | append: '"' %}{% assign src2 = "'" | append: src | append: "'" %}{% assign dst2 = "'" | append: translation | append: "'" %}{% assign src3 = ">" | append: src | append: "<" %}{% assign dst3 = ">" | append: translation | append: "<" %}{% assign content = content | replace: src1, dst1 %}{% assign content = content | replace: src2, dst2 %}{% assign content = content | replace: src3, dst3 %}{% endfor %}{% assign type_translation_namespace = "ty" | append: language %}{% for type_translation in shop.metafields[type_translation_namespace] %}{% assign src = type_translation | first %}{% assign translation = type_translation | last %}{% assign src1 = '"' | append: src | append: '"' %}{% assign dst1 = '"' | append: translation | append: '"' %}{% assign src2 = "'" | append: src | append: "'" %}{% assign dst2 = "'" | append: translation | append: "'" %}{% assign src3 = ">" | append: src | append: "<" %}{% assign dst3 = ">" | append: translation | append: "<" %}{% assign content = content | replace: src1, dst1 %}{% assign content = content | replace: src2, dst2 %}{% assign content = content | replace: src3, dst3 %}{% endfor %}{% endif %}{% assign content = content | replace: '#ly_cu', '' %}{% assign se_list_namespace = language | append: "se" %}{% assign se_list_key = theme.id | append: "se" %}{% assign se_list = shop.metafields[se_list_namespace][se_list_key] %}{% if se_list and se_list != 'empty' %}{% assign se_list = se_list | split: ',' %}{% include 'ly-html-parser' content:content %}{% assign global_parser_results = parser_results %}{% assign global_parser_results_non_stripped = parser_results_non_stripped %}{% for se_key in se_list %}{% assign se_mf_value_namespace = language | append: "se_e" %}{% assign se_mf_value = shop.metafields[se_mf_value_namespace][se_key] %}{% assign se_mf_value = se_mf_value | split: "#section#" %}{% assign se_src = se_mf_value | first %}{% assign se_dst = se_mf_value | last %}{% assign valid = true %}{% include 'ly-html-parser' content:se_src %}{% assign parser_results_size = parser_results | size %}{% if parser_results_size == 1 %}{% assign se_src_size = se_src | size %}{% assign se_src_space_size = se_src | split: ' ' | size %}{% if se_src_size > 20 or se_src_space_size > 3 %}{% else %}{% assign valid = false %}{% for global_parser_result_non_stripped in global_parser_results_non_stripped %}{% assign global_parser_result_stripped = global_parser_result_non_stripped | replace: '<', '' | replace: '>', '' %}{% assign global_parser_result_stripped = global_parser_result_stripped | strip_newlines | strip %}{% if se_src == global_parser_result_stripped %}{% assign used_se_dst = global_parser_result_non_stripped | replace: se_src, se_dst %}{% assign content = content | replace: global_parser_result_non_stripped, used_se_dst %}{% endif %}{% endfor %}{% endif %}{% else %}{% for parser_result in parser_results %}{% unless global_parser_results contains parser_result %}{% assign valid = false %}{% break %}{% endunless %}{% endfor %}{% endif %}{% if valid == true %}{% assign content = content | replace: se_src, se_dst %}{% endif %}{% endfor %}{% endif %}{% assign images = content | split: '"//cdn.shopify.com/' %}{% for image in images %}{% assign used_image_cdn = image | split: '"' | first | append: '#end_of_file#' %}{% assign used_image = image | split: '"' | first | split: '?v=' | first | append: '#end_of_file#' %}{% if used_image contains '.jpg#end_of_file#' or used_image contains '.jpeg#end_of_file#' or used_image contains '.png#end_of_file#' %}{% assign used_image_cdn = "//cdn.shopify.com/" | append: used_image_cdn | replace: '#end_of_file#', '' %}{% assign used_image = "//cdn.shopify.com/" | append: used_image | replace: '#end_of_file#', '' %}{% assign used_image_name = used_image | split: '/' | last %}{% assign last_ = used_image_name | split: '_' | last %}{% assign last_ = '_' | append: last_ %}{% assign used_image_name = used_image_name | replace: last_, '' %}{% if used_image contains used_image_name %}{% assign si_ns = language | append: '#' | append: theme.id %}{% assign si_key = used_image_name | md5 | append: "..." | truncate: 33 | replace: '...', '' %}{% assign si_translation = shop.metafields[si_ns][si_key] %}{% assign si_translation = shop.metafields[si_ns][si_key] | asset_url %}{% if si_translation != empty %}{% assign content = content | replace: used_image_cdn, si_translation %}{% endif %}{% endif %}{% endif %}{% endfor %}{% assign images = content | split: '"//cdn2.shopify.com/' %}{% for image in images %}{% assign used_image_cdn = image | split: '"' | first | append: '#end_of_file#' %}{% assign used_image = image | split: '"' | first | split: '?v=' | first | append: '#end_of_file#' %}{% if used_image contains '.jpg#end_of_file#' or used_image contains '.jpeg#end_of_file#' or used_image contains '.png#end_of_file#' %}{% assign used_image_cdn = "//cdn2.shopify.com/" | append: used_image_cdn | replace: '#end_of_file#', '' %}{% assign used_image = "//cdn2.shopify.com/" | append: used_image | replace: '#end_of_file#', '' %}{% assign used_image_name = used_image | split: '/' | last %}{% assign last_ = used_image_name | split: '_' | last %}{% assign last_ = '_' | append: last_ %}{% assign used_image_name = used_image_name | replace: last_, '' %}{% if used_image contains used_image_name %}{% assign si_ns = language | append: '#' | append: theme.id %}{% assign si_key = used_image_name | md5 | append: "..." | truncate: 33 | replace: '...', '' %}{% assign si_translation = shop.metafields[si_ns][si_key] %}{% assign si_translation = shop.metafields[si_ns][si_key] | asset_url %}{% if si_translation != empty %}{% assign content = content | replace: used_image_cdn, si_translation %}{% endif %}{% endif %}{% endif %}{% endfor %}{{ content }}